<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Business Empire Mobile</title>
  <script>
// ===================== DATA SDK ===================== //
// Compatible with your game's handler.onDataChanged(dataArray)
// and with autoSave() which calls dataSdk.create(...) or dataSdk.update(...)

(function () {
  const SAVE_KEY = "business_empire_save_v1";

  window.dataSdk = window.dataSdk || {};

  // internal handler set by init()
  window.dataSdk.handler = null;

  function loadRaw() {
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) return null;
    try { return JSON.parse(raw); } catch (e) { console.error("dataSdk.parse error", e); return null; }
  }

  function saveRaw(obj) {
    try {
      localStorage.setItem(SAVE_KEY, JSON.stringify(obj));
      return true;
    } catch (e) {
      console.error("dataSdk.save error", e);
      return false;
    }
  }

  // init(handler) -> calls handler.onDataChanged(dataArray)
  window.dataSdk.init = async function (handler) {
    this.handler = handler || null;

    const saved = loadRaw();
    const dataArray = saved ? [saved] : [];

    // call game handler in next tick to avoid blocking
    try {
      if (this.handler && typeof this.handler.onDataChanged === "function") {
        this.handler.onDataChanged(dataArray);
      }
    } catch (e) {
      console.error("dataSdk.init handler error", e);
    }

    return { isOk: true };
  };

  // create(record) - used when saving first time
  window.dataSdk.create = async function (record) {
    try {
      // add an id if missing
      if (!record.id) record.id = "save-" + Date.now();
      saveRaw(record);

      if (this.handler && typeof this.handler.onDataChanged === "function") {
        this.handler.onDataChanged([record]);
      }

      return { isOk: true, record };
    } catch (e) {
      console.error("dataSdk.create error", e);
      return { isOk: false, error: e };
    }
  };

  // update(record) - used when updating existing save
  window.dataSdk.update = async function (record) {
    try {
      // keep id if exists, otherwise create new id
      if (!record.id) record.id = "save-" + Date.now();
      saveRaw(record);

      if (this.handler && typeof this.handler.onDataChanged === "function") {
        this.handler.onDataChanged([record]);
      }

      return { isOk: true, record };
    } catch (e) {
      console.error("dataSdk.update error", e);
      return { isOk: false, error: e };
    }
  };

  // alias for update (some scripts call updateRecord)
  window.dataSdk.updateRecord = window.dataSdk.update;

  // simple getAll() - returns array (keeps parity with handler expectations)
  window.dataSdk.getAll = function () {
    const s = loadRaw();
    return s ? [s] : [];
  };

  // convenience: clear save (dev)
  window.dataSdk.clear = function () {
    localStorage.removeItem(SAVE_KEY);
    if (this.handler && typeof this.handler.onDataChanged === "function") {
      this.handler.onDataChanged([]);
    }
    return { isOk: true };
  };
})();
</script>
  <script>
// ===================== ELEMENT SDK ===================== //
// Provides init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues })
// Persists config to localStorage and always calls onConfigChange(config)

(function () {
  const CONFIG_KEY = "business_empire_config_v1";
  window.elementSdk = window.elementSdk || {};

  window.elementSdk.config = {};
  window.elementSdk.onConfigChange = null;
  window.elementSdk.mapToCapabilities = null;
  window.elementSdk.mapToEditPanelValues = null;
  window.elementSdk.defaultConfig = {};

  function loadConfig() {
    const raw = localStorage.getItem(CONFIG_KEY);
    if (!raw) return null;
    try { return JSON.parse(raw); } catch (e) { console.error("elementSdk.parse error", e); return null; }
  }

  function saveConfig(cfg) {
    try {
      localStorage.setItem(CONFIG_KEY, JSON.stringify(cfg));
      return true;
    } catch (e) {
      console.error("elementSdk.save error", e);
      return false;
    }
  }

  window.elementSdk.init = async function ({ defaultConfig = {}, onConfigChange = () => {}, mapToCapabilities = () => ({}), mapToEditPanelValues = () => new Map() } = {}) {
    this.defaultConfig = { ...defaultConfig };
    this.onConfigChange = onConfigChange;
    this.mapToCapabilities = mapToCapabilities;
    this.mapToEditPanelValues = mapToEditPanelValues;

    // load stored config or fallback to defaultConfig
    const stored = loadConfig();
    this.config = stored ? { ...defaultConfig, ...stored } : { ...defaultConfig };

    // ensure default keys exist
    for (const k in defaultConfig) {
      if (this.config[k] === undefined) this.config[k] = defaultConfig[k];
    }

    // expose config for convenience (game reads window.elementSdk?.config?.currency_symbol)
    window.elementSdk.config = this.config;

    // call game's handler
    try {
      await this.onConfigChange(this.config);
    } catch (e) {
      console.error("elementSdk.onConfigChange error", e);
    }

    return { isOk: true };
  };

  // updateConfig(newConfig) - merges, persists, and notifies
  window.elementSdk.updateConfig = async function (newConfig = {}) {
    this.config = { ...this.config, ...newConfig };
    window.elementSdk.config = this.config;
    saveConfig(this.config);

    try {
      if (this.onConfigChange) await this.onConfigChange(this.config);
    } catch (e) {
      console.error("elementSdk.updateConfig onConfigChange error", e);
    }

    return { isOk: true, config: this.config };
  };

  window.elementSdk.getCapabilities = function () {
    try {
      if (typeof this.mapToCapabilities === "function") return this.mapToCapabilities(this.config);
    } catch (e) { console.error(e); }
    return {};
  };

  window.elementSdk.getEditPanelValues = function () {
    try {
      if (typeof this.mapToEditPanelValues === "function") return this.mapToEditPanelValues(this.config);
    } catch (e) { console.error(e); }
    return new Map();
  };
})();
  </script>
  <link rel="stylesheet" href="style.css">
  <style>@view-transition { navigation: auto; }</style>
  <script src="tailwindcss.js" type="text/javascript"></script>
 </head>
 <body>
  <div class="mobile-app">
   <header class="header">
    <div class="header-top">
     <h1 class="game-title" id="gameTitle">Business Empire Mobile</h1><button class="settings-btn" onclick="openSettings()">âš™ï¸</button>
    </div>
    <div class="stats-grid">
     <div class="stat-card">
      <div class="stat-value" id="cashDisplay">
       $0
      </div>
      <div class="stat-label">
       Cash
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-value" id="incomeDisplay">
       $0/s
      </div>
      <div class="stat-label">
       Income
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-value" id="levelDisplay">
       1
      </div>
      <div class="stat-label">
       Level
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-value" id="prestigeDisplay">
       0
      </div>
      <div class="stat-label">
       Prestige
      </div>
     </div>
    </div>
   </header>
   <div id="eventBanner" class="event-banner" style="display: none;">
    <div class="event-title" id="eventTitle"></div>
    <div class="event-description" id="eventDescription"></div>
   </div>
   <nav class="tab-navigation"><button class="tab-btn active" onclick="switchTab('businesses')">ğŸ¢ Business</button> <button class="tab-btn" onclick="switchTab('cities')">ğŸŒ Cities</button> <button class="tab-btn" onclick="switchTab('upgrades')">âš¡ Upgrades</button> <button class="tab-btn" onclick="switchTab('stocks')">ğŸ“ˆ Stocks</button> <button class="tab-btn" onclick="switchTab('achievements')">ğŸ† Goals</button> <button class="tab-btn" onclick="switchTab('skills')">ğŸ¯ Skills</button>
   </nav>
   <main class="main-content">
    <div id="businesses" class="tab-content active">
     <h2 class="section-title">ğŸ¢ Business Empire</h2>
     <div id="currentCityInfo" class="prestige-section" style="background: linear-gradient(45deg, #4ade80, #22c55e); color: #1a1a1a; margin-bottom: 20px;">
      <div class="prestige-title" id="currentCityName">
       ğŸ—½ New York
      </div>
      <p id="currentCityDesc">The Big Apple - Financial capital</p>
     </div>
     <div id="prestigeSection" class="prestige-section" style="display: none;">
      <div class="prestige-title">
       Ready to Prestige?
      </div>
      <p>Reset your progress for permanent bonuses!</p><button class="prestige-btn" onclick="showPrestigeModal()">Prestige Now</button>
     </div>
     <div class="business-grid" id="businessGrid"></div>
    </div>
    <div id="cities" class="tab-content">
     <h2 class="section-title">ğŸŒ Global Expansion</h2>
     <div class="business-grid" id="cityGrid"></div>
    </div>
    <div id="upgrades" class="tab-content">
     <h2 class="section-title">âš¡ Business Upgrades</h2>
     <div class="business-grid" id="upgradeGrid"></div>
    </div>
    <div id="stocks" class="tab-content">
     <h2 class="section-title">ğŸ“ˆ Stock Market</h2>
     <div class="stock-grid" id="stockGrid"></div>
    </div>
    <div id="achievements" class="tab-content">
     <h2 class="section-title">ğŸ† Achievements</h2>
     <div class="achievement-grid" id="achievementGrid"></div>
     <h3 class="section-title" style="margin-top: 30px;">ğŸ“… Daily Challenges</h3>
     <div class="daily-challenges" id="dailyChallenges"></div>
    </div>
    <div id="skills" class="tab-content">
     <h2 class="section-title">ğŸ¯ Skill Tree</h2>
     <div class="skill-tree" id="skillTree"></div>
    </div>
   </main><button class="floating-action" onclick="collectAllIncome()" id="collectBtn">ğŸ’°</button>
  </div><!-- Modals -->
  <div id="settingsModal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeModal('settingsModal')">Ã—</button>
    <h2 class="modal-title">âš™ï¸ Settings</h2>
    <div class="action-grid"><button class="action-btn" onclick="toggleTheme()">
      <div>
       ğŸŒ™ Toggle Dark/Light Theme
      </div></button> <button class="action-btn" onclick="toggleSound()">
      <div>
       ğŸ”Š Toggle Sound Effects
      </div></button> <button class="action-btn" onclick="exportProgress()">
      <div>
       ğŸ“¤ Export Progress
      </div></button> <button class="action-btn" onclick="showStats()">
      <div>
       ğŸ“Š View Statistics
      </div></button> <button class="action-btn" onclick="autoSave()">
      <div>
       ğŸ’¾ Save Game
      </div></button>
    </div>
   </div>
  </div>
  <div id="prestigeModal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeModal('prestigeModal')">Ã—</button>
    <h2 class="modal-title">âœ¨ Prestige System</h2>
    <p>Prestiging will reset your progress but grant permanent bonuses!</p>
    <div id="prestigeInfo"></div>
    <div style="margin-top: 20px;"><button class="prestige-btn" onclick="performPrestige()" style="margin-right: 10px;">Confirm Prestige</button> <button class="action-btn" onclick="closeModal('prestigeModal')" style="display: inline-block; width: auto; padding: 12px 24px;">Cancel</button>
    </div>
   </div>
  </div>
  <div class="notification" id="notification"></div>
  <script src="script.js"></script>
 </body>
</html>
